<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ustc.yzwx.integration.student.dao.StudentDao">
	<resultMap id="BaseResultMap" type="ustc.yzwx.presentation.student.form.Student">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Feb 25 
			17:50:21 CST 2014. -->
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="wx_code" property="wxCode" jdbcType="VARCHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="email" property="email" jdbcType="VARCHAR" />
		<result column="contact" property="contact" jdbcType="VARCHAR" />
		<result column="gpa" property="gpa" jdbcType="REAL" />
		<result column="status" property="status" jdbcType="SMALLINT" />
		<result column="student_major" property="studentMajor"
			jdbcType="VARCHAR" />
		<result column="class_size" property="classSize" jdbcType="INTEGER" />
		<result column="student_rank" property="studentRank" jdbcType="INTEGER" />
		<!-- <result column="school_id" property="schoolId" jdbcType="INTEGER" /> -->
		<association property="school" column="school_id" select="querySchool"></association>
		<!-- <result column="major_code" property="majorCode" jdbcType="VARCHAR" /> -->
		<association property="major" column="major_code" select="queryMajor"></association>
	</resultMap>

	<!-- 学校 -->
	<resultMap id="SchoolResult" type="ustc.yzwx.presentation.student.form.School">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="province" property="province" jdbcType="VARCHAR" />
		<result column="city" property="city" jdbcType="VARCHAR" />
		<result column="type" property="type" jdbcType="VARCHAR" />
	</resultMap>

	<select id="querySchool" resultMap="SchoolResult">
		select id, name, province, city, type from wx_school where id =#{id}
	</select>

	<!-- 专业 -->
	<resultMap id="MajorResult" type="ustc.yzwx.presentation.student.form.Major">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="code" property="code" jdbcType="VARCHAR" />
		<result column="parent_code" property="parentCode" jdbcType="VARCHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="type" property="type" jdbcType="SMALLINT" />
	</resultMap>

	<select id="queryMajor" resultMap="MajorResult">
		select id ,code ,parent_code ,name ,type from wx_major where code =#{code}
	</select>

	<resultMap id="ResultMapWithBLOBs" type="ustc.yzwx.presentation.student.form.Student"
		extends="BaseResultMap">
		<result column="gpa_img" property="gpaImg" jdbcType="LONGVARBINARY" />
	</resultMap>
	<sql id="Base_Column_List">
		id, wx_code, name, school_id, major_code, email, contact,
		gpa, status,
		student_major,
		class_size, student_rank
	</sql>
	<sql id="Blob_Column_List">
		gpa_img
	</sql>
	<select id="selectByPrimaryKey" resultMap="ResultMapWithBLOBs"
		parameterType="java.lang.String">
		select
		<include refid="Base_Column_List" />
		,
		<include refid="Blob_Column_List" />
		from wx_student
		where id = #{id,jdbcType=VARCHAR}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.String">
		delete from
		wx_student
		where id = #{id,jdbcType=VARCHAR}
	</delete>
	<insert id="insert" parameterType="ustc.yzwx.presentation.student.form.Student">
		insert into wx_student (id,
		wx_code, name,
		school_id, major_code, email,
		contact, gpa, status,
		student_major, class_size, student_rank,
		gpa_img)
		values
		(#{id,jdbcType=VARCHAR}, #{wxCode,jdbcType=VARCHAR},
		#{name,jdbcType=VARCHAR},
		#{schoolId,jdbcType=INTEGER},
		#{majorCode,jdbcType=VARCHAR}, #{email,jdbcType=VARCHAR},
		#{contact,jdbcType=VARCHAR}, #{gpa,jdbcType=REAL},
		#{status,jdbcType=SMALLINT},
		#{studentMajor,jdbcType=VARCHAR},
		#{classSize,jdbcType=INTEGER}, #{studentRank,jdbcType=INTEGER},
		#{gpaImg,jdbcType=LONGVARBINARY})
	</insert>
	<insert id="insertSelective" parameterType="ustc.yzwx.presentation.student.form.Student">
		insert into wx_student
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="wxCode != null">
				wx_code,
			</if>
			<if test="name != null">
				name,
			</if>
			<if test="schoolId != null">
				school_id,
			</if>
			<if test="majorCode != null">
				major_code,
			</if>
			<if test="email != null">
				email,
			</if>
			<if test="contact != null">
				contact,
			</if>
			<if test="gpa != null">
				gpa,
			</if>
			<if test="status != null">
				status,
			</if>
			<if test="studentMajor != null">
				student_major,
			</if>
			<if test="classSize != null">
				class_size,
			</if>
			<if test="studentRank != null">
				student_rank,
			</if>
			<if test="gpaImg != null">
				gpa_img,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=VARCHAR},
			</if>
			<if test="wxCode != null">
				#{wxCode,jdbcType=VARCHAR},
			</if>
			<if test="name != null">
				#{name,jdbcType=VARCHAR},
			</if>
			<if test="schoolId != null">
				#{schoolId,jdbcType=INTEGER},
			</if>
			<if test="majorCode != null">
				#{majorCode,jdbcType=VARCHAR},
			</if>
			<if test="email != null">
				#{email,jdbcType=VARCHAR},
			</if>
			<if test="contact != null">
				#{contact,jdbcType=VARCHAR},
			</if>
			<if test="gpa != null">
				#{gpa,jdbcType=REAL},
			</if>
			<if test="status != null">
				#{status,jdbcType=SMALLINT},
			</if>
			<if test="studentMajor != null">
				#{studentMajor,jdbcType=VARCHAR},
			</if>
			<if test="classSize != null">
				#{classSize,jdbcType=INTEGER},
			</if>
			<if test="studentRank != null">
				#{studentRank,jdbcType=INTEGER},
			</if>
			<if test="gpaImg != null">
				#{gpaImg,jdbcType=LONGVARBINARY},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="ustc.yzwx.presentation.student.form.Student">
		update wx_student
		<set>
			<if test="wxCode != null">
				wx_code = #{wxCode,jdbcType=VARCHAR},
			</if>
			<if test="name != null">
				name = #{name,jdbcType=VARCHAR},
			</if>
			<if test="schoolId != null">
				school_id = #{schoolId,jdbcType=INTEGER},
			</if>
			<if test="majorCode != null">
				major_code = #{majorCode,jdbcType=VARCHAR},
			</if>
			<if test="email != null">
				email = #{email,jdbcType=VARCHAR},
			</if>
			<if test="contact != null">
				contact = #{contact,jdbcType=VARCHAR},
			</if>
			<if test="gpa != null">
				gpa = #{gpa,jdbcType=REAL},
			</if>
			<if test="status != null">
				status = #{status,jdbcType=SMALLINT},
			</if>
			<if test="studentMajor != null">
				student_major = #{studentMajor,jdbcType=VARCHAR},
			</if>
			<if test="classSize != null">
				class_size = #{classSize,jdbcType=INTEGER},
			</if>
			<if test="studentRank != null">
				student_rank = #{studentRank,jdbcType=INTEGER},
			</if>
			<if test="gpaImg != null">
				gpa_img = #{gpaImg,jdbcType=LONGVARBINARY},
			</if>
		</set>
		where id = #{id,jdbcType=VARCHAR}
	</update>
	<update id="updateByPrimaryKeyWithBLOBs" parameterType="ustc.yzwx.presentation.student.form.Student">
		update
		wx_student
		set wx_code = #{wxCode,jdbcType=VARCHAR},
		name =
		#{name,jdbcType=VARCHAR},
		school_id = #{schoolId,jdbcType=INTEGER},
		major_code = #{majorCode,jdbcType=VARCHAR},
		email =
		#{email,jdbcType=VARCHAR},
		contact = #{contact,jdbcType=VARCHAR},
		gpa =
		#{gpa,jdbcType=REAL},
		status = #{status,jdbcType=SMALLINT},
		student_major = #{studentMajor,jdbcType=VARCHAR},
		class_size =
		#{classSize,jdbcType=INTEGER},
		student_rank =
		#{studentRank,jdbcType=INTEGER},
		gpa_img =
		#{gpaImg,jdbcType=LONGVARBINARY}
		where id = #{id,jdbcType=VARCHAR}
	</update>
	<update id="updateByPrimaryKey" parameterType="ustc.yzwx.presentation.student.form.Student">
		update wx_student
		set wx_code = #{wxCode,jdbcType=VARCHAR},
		name =
		#{name,jdbcType=VARCHAR},
		school_id = #{schoolId,jdbcType=INTEGER},
		major_code = #{majorCode,jdbcType=VARCHAR},
		email =
		#{email,jdbcType=VARCHAR},
		contact = #{contact,jdbcType=VARCHAR},
		gpa =
		#{gpa,jdbcType=REAL},
		status = #{status,jdbcType=SMALLINT},
		student_major = #{studentMajor,jdbcType=VARCHAR},
		class_size =
		#{classSize,jdbcType=INTEGER},
		student_rank =
		#{studentRank,jdbcType=INTEGER}
		where id = #{id,jdbcType=VARCHAR}
	</update>

	<!-- 根据活动id 查询该活动下所有考生 -->
	<select id="findByActivity" resultMap="BaseResultMap">
		select id ,name,school_id,major_code,contact
		from wx_student
		<if test="activityId!='' and activityId !=null">
			,wx_partake_record
			where id = student_id
			and activity_id=
			#{activityId}
		</if>
		LIMIT #{offset},#{limit}
	</select>

	<!-- 查询所有考生 -->
	<select id="totalCountByActivity" resultType="Integer">
		select count(id)
		from wx_student
		<if test="activityId !='' and activityId !=null">
			,wx_partake_record
			where id = student_id
			and activity_id=
			#{activityId}
		</if>
	</select>
	
	<!-- 联合查询所有考生 -->
	<select id="findByParams" parameterType="ustc.yzwx.integration.student.dao.seachObj.StudentSeachObj" resultMap="BaseResultMap">
		select stu.id ,stu.name,stu.school_id,stu.major_code,stu.contact ,stu.student_major
		from wx_student stu
		<if test="activityId!='' and activityId !=null">
			 join wx_partake_record pr on stu.id= pr.student_id  and pr.activity_id = #{activityId}
		</if>
		where 1=1
		<if test="majorCode!='' and majorCode!=null">
			 and stu.major_code = #{majorCode}
		</if>
		<if test="provinceId!='' and provinceId!=null">
			 and stu.id in (select stu.id  from wx_student stu,wx_school sch where stu.school_id = sch.id and sch.province =#{provinceId})
		</if>
		LIMIT #{offset},#{limit}
	</select>
	
	<!-- 联合查询所有考生Count 分页用-->
	<select id="countByParams" parameterType="ustc.yzwx.integration.student.dao.seachObj.StudentSeachObj" resultType="Integer">
		select count(*)
		from wx_student stu
		<if test="activityId!='' and activityId !=null">
			 join wx_partake_record pr on stu.id= pr.student_id  and pr.activity_id = #{activityId}
		</if>
		where 1=1
		<if test="majorCode!='' and majorCode!=null">
			 and stu.major_code = #{majorCode}
		</if>
		<if test="provinceId!='' and provinceId!=null">
			 and stu.id in (select stu.id  from wx_student stu,wx_school sch where stu.school_id = sch.id and sch.province =#{provinceId})
		</if>
	</select>
</mapper>